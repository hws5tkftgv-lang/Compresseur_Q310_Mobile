<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Q310 â€“ Mobile iPhone</title>

<script src="https://cdn.jsdelivr.net/npm/fabric@5.3.0/dist/fabric.min.js"></script>

<style>
html,body{
  margin:0;
  background:#0b1436;
  color:#eaf1ff;
  font-family:Arial,Segoe UI,sans-serif;
  overscroll-behavior:none;
  touch-action:none;
}

#infoPanel{
  padding:10px 12px;
  background:#0f1a44;
  border-bottom:1px solid rgba(255,255,255,.15);
}

#infoTitle{
  font-size:18px;
  font-weight:700;
}

.stage{
  position:relative;
  height:70vh;
  background:#0b1536;
  overflow:hidden;
}

.media-layer,canvas{
  position:absolute;
  inset:0;
}
</style>
</head>

<body>

<div id="infoPanel">
  <div id="infoTitle">SÃ©lectionne une zone</div>
</div>

<div class="stage" id="stage">
  <div class="media-layer">
    <img id="imgLayer">
  </div>
  <canvas id="c"></canvas>
</div>

<script>
/* ================= CONFIG ================= */

// Image mobile
const IMAGE_URL = "actif/compresseur_bg.png";

// JSON zones (PC)
const ZONES_JSON_URL = "quincy_310L_parts.json";

// ðŸ”´ DIMENSIONS RÃ‰ELLES DE Lâ€™IMAGE PC (CLÃ‰ DE TOUT)
const PC_IMAGE_WIDTH  = 1200;
const PC_IMAGE_HEIGHT = 1600;

/* ================= CANVAS ================= */

const canvas = new fabric.Canvas("c",{
  selection:false,
  allowTouchScrolling:false,
  preserveObjectStacking:true
});

const stage = document.getElementById("stage");
const imgEl  = document.getElementById("imgLayer");

/* ================= IMAGE ================= */

imgEl.src = IMAGE_URL;

imgEl.onload = ()=>{
  resizeAll();
  loadZonesFromJSON();
};

function resizeAll(){
  canvas.setWidth(stage.clientWidth);
  canvas.setHeight(stage.clientHeight);

  imgEl.style.width  = stage.clientWidth + "px";
  imgEl.style.height = stage.clientHeight + "px";
}

/* ================= ZONES ================= */

function makeZone(x,y,w,h,text){
  const r = new fabric.Rect({
    left:x,
    top:y,
    width:w,
    height:h,
    fill:"rgba(0,0,0,0)",
    stroke:"rgba(255,255,255,.8)",
    strokeWidth:2,
    selectable:false,
    evented:true
  });

  r.partId = text;

  r.on("mousedown", ()=>{
    document.getElementById("infoTitle").textContent = r.partId;
  });

  canvas.add(r);
  r.bringToFront();
}

async function loadZonesFromJSON(){
  const res = await fetch(ZONES_JSON_URL);
  const data = await res.json();

  canvas.clear();

  const scaleX = stage.clientWidth  / PC_IMAGE_WIDTH;
  const scaleY = stage.clientHeight / PC_IMAGE_HEIGHT;

  data.forEach(z=>{
    makeZone(
      z.imgBox.x * scaleX,
      z.imgBox.y * scaleY,
      z.imgBox.w * scaleX,
      z.imgBox.h * scaleY,
      z.partId
    );
  });

  canvas.requestRenderAll();
}
</script>

</body>
</html>
